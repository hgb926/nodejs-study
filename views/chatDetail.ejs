<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .wrap {
            width: 50%;
            margin: 0 auto;
            border: 1px solid black;
            border-radius: 16px;
            padding: 20px;
        }
        .detail-bg {
            background: white;
            padding: 15px;
            margin-top: 10px;

        }

        .chat-screen {
            width: 100%;
        }

        .chat-box {
            margin-top: 15px;
            display: flex;
        }

        .chat-box span {
            padding: 10px;
            background: #eee;
        }

        .mine {
            justify-content: end;
        }

        .chat-input {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
        }

        .chat-button {
            padding: 10px;
            border: none;
            background: lightgrey;
            border-radius: 5px;
        }
    </style>
</head>
<body class="grey-bg">
<%- include("nav.ejs") %>
<%= JSON.stringify(result)%>
<div class="wrap">
    <div class="detail-bg">
        <div class="chat-screen">
            <div class="chat-box"><span>안녕하세요</span></div>
            <div class="chat-box"><span>안녕하세요</span></div>
            <div class="chat-box mine"><span>안녕하세요</span></div>
        </div>
    </div>
    <div class="chat-form">
        <input class="chat-input">
        <button class="chat-button">전송</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/socket.io@4.7.2/client-dist/socket.io.min.js"></script>
<script>
    const socket = io()     // chatRoom DocumentId로 룸 생성
    socket.emit('ask-join', '<%= result._id%>') //  [유저 -> 서버] 데이터 전송

    document.querySelector('.chat-button').addEventListener('click', () => {
        const value = document.querySelector('.chat-input').value;
        socket.emit('message', { msg : value, room : '<%= result._id%>' })
    })

    socket.on('broadcast', (data) => { // [서버 -> 유저] 데이터 수신
        console.log('broadcast : ', data)
        document.querySelector('.chat-screen').insertAdjacentHTML('beforeend',
        `<div class="chat-box"><span>${data}</span></div>`)
    })
</script>

</body>
</html>